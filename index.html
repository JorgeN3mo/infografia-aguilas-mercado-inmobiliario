<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lisis de Inversi√≥n Inmobiliaria en √Åguilas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chosen Palette: Calm Harmony -->
    <!-- Application Structure Plan: The SPA is designed as an interactive dashboard. It starts with high-level market metrics, then allows users to explore investment zones through interactive cards. The core of the app is a powerful, filterable "Investment Funnel" that displays properties as cards, moving away from a static table. Clicking a card reveals a detailed modal view. This is followed by visual data analysis with charts (profitability by zone, price vs. value). The structure concludes with strategic advice. This task-oriented flow (from broad market to specific property to strategy) is more intuitive and useful for an investor than a linear report, allowing them to actively find opportunities rather than passively read findings. -->
    <!-- Visualization & Content Choices: 
        - Report Info: Market overview and zones (Sec 1). -> Goal: Inform & Contextualize. -> Viz/Method: Interactive HTML/CSS cards. -> Interaction: Click to expand/reveal info. -> Justification: More engaging than paragraphs of text. Library: Vanilla JS.
        - Report Info: Top 20 properties table (Sec 4). -> Goal: Compare & Find. -> Viz/Method: Filterable list of property cards. -> Interaction: Apply filters (zone, extras), sort, click for detail modal. -> Justification: Empowers user to find properties matching specific criteria, far superior to a static table. The detail modal with a mini-chart focuses analysis. Library: Vanilla JS.
        - Report Info: Price vs. Appraisal data. -> Goal: Analyze relationships. -> Viz/Method: Bar Chart (Avg. Profitability by Zone) & Scatter Plot (Price vs. Appraisal). -> Interaction: Tooltips on hover. -> Justification: These charts provide powerful visual summaries of the entire dataset, revealing trends (e.g., which zones are most undervalued) that are not obvious from a table alone. Library: Chart.js.
        - Report Info: Risks and Strategy (Sec 5). -> Goal: Advise. -> Viz/Method: Collapsible accordion sections. -> Interaction: Click to expand. -> Justification: Keeps the UI clean and presents dense information in a digestible format. Library: Vanilla JS.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .section-title {
            font-size: 1.875rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 1rem;
            text-align: center;
        }
        .section-subtitle {
            font-size: 1.125rem;
            color: #475569;
            text-align: center;
            max-width: 800px;
            margin: 0 auto 2.5rem auto;
        }
        .nav-button {
            transition: all 0.3s ease;
            color: #475569;
        }
        .nav-button:hover {
            color: #0891b2;
            transform: translateY(-2px);
        }
        .property-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .property-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex-shrink-0">
                    <h1 class="text-xl font-bold text-slate-900">üè† Inversi√≥n √Åguilas</h1>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#mercado" class="nav-button px-3 py-2 rounded-md text-sm font-medium">Mercado</a>
                        <a href="#oportunidades" class="nav-button px-3 py-2 rounded-md text-sm font-medium">Oportunidades</a>
                        <a href="#analisis" class="nav-button px-3 py-2 rounded-md text-sm font-medium">An√°lisis Visual</a>
                        <a href="#estrategia" class="nav-button px-3 py-2 rounded-md text-sm font-medium">Estrategia</a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">

        <!-- HERO SECTION -->
        <section class="text-center mb-16">
            <h1 class="text-4xl md:text-5xl font-extrabold text-slate-900 mb-4">Descubra Oportunidades de Inversi√≥n Inmobiliaria en √Åguilas</h1>
            <p class="max-w-3xl mx-auto text-lg text-slate-600">Una herramienta interactiva para analizar, filtrar y identificar las propiedades m√°s rentables para alquiler tur√≠stico en la Costa C√°lida.</p>
            <div class="mt-8 flex justify-center gap-4 flex-wrap">
                <div class="bg-white p-4 rounded-lg shadow-md border border-slate-200">
                    <p class="text-sm text-slate-500">Precio M√°ximo</p>
                    <p class="text-xl font-bold text-cyan-600">150.000 ‚Ç¨</p>
                </div>
                <div class="bg-white p-4 rounded-lg shadow-md border border-slate-200">
                    <p class="text-sm text-slate-500">Crecimiento Anual Precio</p>
                    <p class="text-xl font-bold text-green-600">+26.2%</p>
                </div>
                <div class="bg-white p-4 rounded-lg shadow-md border border-slate-200">
                    <p class="text-sm text-slate-500">Oportunidades Analizadas</p>
                    <p class="text-xl font-bold text-cyan-600">20</p>
                </div>
            </div>
        </section>

        <!-- ZONAS DE INVERSION -->
        <section id="mercado" class="mb-16 scroll-mt-20">
            <h2 class="section-title">Geograf√≠a de la Oportunidad</h2>
            <p class="section-subtitle">√Åguilas ofrece diversas zonas con perfiles de inversi√≥n distintos. Haga clic en cada una para entender su potencial, precios de referencia y atractivo para el alquiler tur√≠stico. Esta selecci√≥n es clave para enfocar su b√∫squeda.</p>
            <div id="zone-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            </div>
        </section>

        <!-- OPORTUNIDADES -->
        <section id="oportunidades" class="mb-16 scroll-mt-20">
            <h2 class="section-title">Cat√°logo Interactivo de Oportunidades</h2>
            <p class="section-subtitle">Aqu√≠ se encuentran las 20 propiedades con mayor potencial de rentabilidad. Use los filtros para acotar la b√∫squeda seg√∫n sus preferencias y haga clic en "Ver Detalles" para un an√°lisis completo de cada activo.</p>

            <!-- FILTROS -->
            <div class="bg-white p-6 rounded-xl shadow-lg mb-8 border border-slate-200">
                <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-5 gap-6">
                    <div class="md:col-span-3 lg:col-span-2">
                        <h4 class="font-semibold mb-2 text-slate-700">Filtrar por Zona</h4>
                        <div id="zone-filters" class="grid grid-cols-2 sm:grid-cols-3 gap-2"></div>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-2 text-slate-700">Extras Clave</h4>
                        <div id="extras-filters" class="space-y-2"></div>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-2 text-slate-700">Habitaciones</h4>
                        <div id="rooms-filters" class="space-y-2"></div>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-2 text-slate-700">Ordenar por</h4>
                        <select id="sort-by" class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500">
                            <option value="diff_perc_desc">Mayor Rentabilidad</option>
                            <option value="price_asc">Precio (Menor a Mayor)</option>
                            <option value="price_desc">Precio (Mayor a Menor)</option>
                            <option value="appraisal_desc">Peritaje (Mayor a Menor)</option>
                        </select>
                    </div>
                </div>
                 <div class="mt-4 text-center">
                    <button id="reset-filters" class="px-4 py-2 bg-slate-200 text-slate-700 rounded-md hover:bg-slate-300 transition">Limpiar Filtros</button>
                </div>
            </div>

            <!-- LISTA DE PROPIEDADES -->
            <div id="properties-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            </div>
            <p id="no-results" class="hidden text-center text-slate-500 text-lg py-8">No se encontraron propiedades con los filtros seleccionados.</p>
        </section>

        <!-- ANALISIS VISUAL -->
        <section id="analisis" class="mb-16 scroll-mt-20">
             <h2 class="section-title">An√°lisis Visual del Mercado</h2>
             <p class="section-subtitle">Estos gr√°ficos resumen la informaci√≥n clave del mercado. El primero muestra la rentabilidad media por zona para identificar las √°reas m√°s interesantes, mientras que el segundo compara el precio de venta con el valor de peritaje para visualizar el panorama completo de oportunidades.</p>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white p-6 rounded-xl shadow-lg border border-slate-200">
                    <h3 class="font-bold text-lg text-center mb-4 text-slate-800">Rentabilidad Media por Zona (%)</h3>
                    <div class="chart-container">
                        <canvas id="profitabilityByZoneChart"></canvas>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-xl shadow-lg border border-slate-200">
                    <h3 class="font-bold text-lg text-center mb-4 text-slate-800">Precio de Venta vs. Valor de Peritaje</h3>
                     <div class="chart-container">
                        <canvas id="priceVsAppraisalChart"></canvas>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- ESTRATEGIA Y RIESGOS -->
        <section id="estrategia" class="scroll-mt-20">
            <h2 class="section-title">Estrategia de Adquisici√≥n y Riesgos Clave</h2>
            <p class="section-subtitle">Una inversi√≥n informada requiere conocer tanto las oportunidades como los riesgos. Explore estas recomendaciones estrat√©gicas y puntos de atenci√≥n para tomar la mejor decisi√≥n de compra.</p>
            <div id="strategy-container" class="max-w-4xl mx-auto space-y-4">
            </div>
        </section>

    </main>
    
    <!-- MODAL -->
    <div id="property-modal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center p-4 z-50">
        <div id="modal-content" class="bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto transform transition-all scale-95 opacity-0">
        </div>
    </div>


<script>
const zonesData = [
    { 
        name: "Los Collados / Los Geraneos",
        id: "los-collados",
        description: "Zona de expansi√≥n con urbanizaciones recientes que suelen incluir piscina y garaje. Representa el mejor compromiso entre precio, calidades modernas y potencial de alquiler, aunque requiere coche.",
        price: "1.865 - 1.987 ‚Ç¨/m¬≤"
    },
    { 
        name: "Casco Antiguo / Centro",
        id: "casco-antiguo",
        description: "Ofrece el encanto local y una ubicaci√≥n estrat√©gica cerca de playas y servicios. El parque inmobiliario es m√°s antiguo, permitiendo encontrar oportunidades, a menudo sin ascensor.",
        price: "1.182 - 1.403 ‚Ç¨/m¬≤"
    },
    { 
        name: "Las Lomas / Las Yucas",
        id: "las-lomas",
        description: "√Årea residencial tranquila y consolidada, muy demandada por su proximidad a la playa de Poniente y servicios. Los precios son competitivos pero en el rango alto del presupuesto.",
        price: "1.896 - 2.144 ‚Ç¨/m¬≤"
    },
    { 
        name: "Calarreona",
        id: "calarreona",
        description: "Muy popular para el turismo familiar por sus excelentes playas. Estructurada en urbanizaciones con buenas calidades y precios que se alinean bien con los objetivos de inversi√≥n.",
        price: "1.552 ‚Ç¨/m¬≤ (aprox.)"
    },
    { 
        name: "Calabardina",
        id: "calabardina",
        description: "Pedan√≠a con car√°cter de pueblo pesquero a 8 km de √Åguilas. Ofrece un ambiente m√°s relajado y precios m√°s bajos, ideal para un perfil de turista que busca desconexi√≥n.",
        price: "1.528 - 1.645 ‚Ç¨/m¬≤"
    }
];

const propertiesData = [
    { id: "LC-01", location: "Los Collados - Los Geraneos", zone: "Los Collados / Los Geraneos", features: "Apartamento 2 hab, 1 ba√±o", sqm: 65, extras: ["Terraza", "Garaje", "Piscina"], price: 95000, appraisal: 134463, diff_eur: 39463, diff_perc: 41.5, alert: "[15, 30] Precio muy competitivo con rebaja significativa. Incluye todos los extras m√°s demandados. Urge verificar estado y gastos de comunidad.", rooms: 2 },
    { id: "LC-02", location: "Los Collados - Los Geraneos", zone: "Los Collados / Los Geraneos", features: "Apartamento 2 hab, 2 ba√±os", sqm: 60, extras: ["Terraza", "Garaje", "Piscina"], price: 98000, appraisal: 136250, diff_eur: 38250, diff_perc: 39.0, alert: "[15] Gran terraza (35m¬≤) que a√±ade mucho valor. Ubicado en residencial tranquilo. Imprescindible coche para los inquilinos.", rooms: 2 },
    { id: "CA-01", location: "Casco Antiguo, Calle Isidoro Cierva", zone: "Casco Antiguo / Centro", features: "Piso 3 hab, 2 ba√±os", sqm: 92, extras: ["Ascensor"], price: 46500, appraisal: 63245, diff_eur: 16745, diff_perc: 36.0, alert: "[16] Precio extremadamente bajo. Procede de activo bancario, posible necesidad de reforma integral no visible en fotos. Oportunidad de alto riesgo/alta recompensa.", rooms: 3 },
    { id: "LM-01", location: "Las Lomas - Las Yucas, C/ Juan Ramon Jimenez", zone: "Las Lomas / Las Yucas", features: "Piso 2 hab, 1 ba√±o", sqm: 70, extras: ["Terraza", "Ascensor", "Vistas mar"], price: 129000, appraisal: 165715, diff_eur: 36715, diff_perc: 28.5, alert: "[26] Excelente ubicaci√≥n a 200m de Playa Poniente. Vistas al mar a√±aden valor. Ideal para segunda residencia o inversi√≥n.", rooms: 2 },
    { id: "LC-03", location: "Los Collados - Los Geraneos", zone: "Los Collados / Los Geraneos", features: "Apartamento 2 hab, 2 ba√±os", sqm: 68, extras: ["Garaje", "Piscina"], price: 110000, appraisal: 139400, diff_eur: 29400, diff_perc: 26.7, alert: "[31] Planta baja con acceso directo a zonas comunes. Cocina americana. Propiedad en buen estado aparente, lista para alquilar.", rooms: 2 },
    { id: "CA-02", location: "Casco Antiguo, Calle Mart√≠", zone: "Casco Antiguo / Centro", features: "Piso 3 hab, 1 ba√±o", sqm: 92, extras: ["Ascensor", "Balc√≥n"], price: 114000, appraisal: 138460, diff_eur: 24460, diff_perc: 21.5, alert: "[31, 32] Ubicaci√≥n c√©ntrica excelente. Luminoso. Anuncio destaca la idoneidad para inversi√≥n. Sin garaje, un punto d√©bil en el centro.", rooms: 3 },
    { id: "CA-03", location: "Casco Antiguo", zone: "Casco Antiguo / Centro", features: "√Åtico 3 hab, 2 ba√±os", sqm: 98, extras: ["Terraza", "Garaje", "Ascensor"], price: 115000, appraisal: 138950, diff_eur: 23950, diff_perc: 20.8, alert: "[27] Un √°tico con garaje en el centro es un activo muy raro y valioso. El precio parece muy ajustado para estas caracter√≠sticas.", rooms: 3 },
    { id: "CR-01", location: "Calarreona, Urb. Calarreona", zone: "Calarreona", features: "Piso 2 hab, 1 ba√±o", sqm: 78, extras: ["Terraza", "Garaje", "Ascensor", "Vistas mar"], price: 135000, appraisal: 162240, diff_eur: 27240, diff_perc: 20.2, alert: "[26] A 500m de la playa de Calarreona. Zona muy demandada en verano. La orientaci√≥n Este y vistas al mar son un plus.", rooms: 2 },
    { id: "CA-04", location: "Casco Antiguo", zone: "Casco Antiguo / Centro", features: "Piso 3 hab, 1 ba√±o", sqm: 109, extras: ["Terraza"], price: 95000, appraisal: 113825, diff_eur: 18825, diff_perc: 19.8, alert: "[27] A menos de 200m de la playa de Levante. Sin ascensor, lo que justifica el precio. La terraza es un gran punto a favor.", rooms: 3 },
    { id: "LC-04", location: "Los Collados - Los Geraneos", zone: "Los Collados / Los Geraneos", features: "Apartamento 2 hab, 2 ba√±os", sqm: 75, extras: ["Terraza", "Piscina"], price: 130000, appraisal: 154375, diff_eur: 24375, diff_perc: 18.8, alert: "[30] Planta baja con acceso directo a la piscina. Ideal para familias con ni√±os. Buen estado de conservaci√≥n aparente.", rooms: 2 },
    { id: "LM-02", location: "Las Lomas - Las Yucas", zone: "Las Lomas / Las Yucas", features: "Piso 3 hab, 1 ba√±o", sqm: 84, extras: ["Sin ascensor"], price: 80000, appraisal: 94080, diff_eur: 14080, diff_perc: 17.6, alert: "[26] Precio de entrada muy bajo para la zona. La falta de ascensor y la necesidad de posible actualizaci√≥n justifican el precio. Buena distribuci√≥n.", rooms: 3 },
    { id: "CA-05", location: "Casco Antiguo, C/ Ram√≥n y Cajal", zone: "Casco Antiguo / Centro", features: "Piso 3 hab, 2 ba√±os", sqm: 110, extras: ["Sin ascensor"], price: 135000, appraisal: 156750, diff_eur: 21750, diff_perc: 16.1, alert: "[27] Piso amplio en el centro. La ausencia de ascensor es el principal punto negativo a considerar para el perfil del inquilino.", rooms: 3 },
    { id: "CB-01", location: "Calabardina", zone: "Calabardina", features: "Planta baja 3 hab, 1 ba√±o", sqm: 83, extras: ["Terraza", "Garaje"], price: 140000, appraisal: 161895, diff_eur: 21895, diff_perc: 15.6, alert: "[27] Ubicaci√≥n en Calabardina, ideal para turismo tranquilo. Incluye garaje, muy necesario en la zona. Buen potencial de alquiler estival.", rooms: 3 },
    { id: "CR-02", location: "Calarreona", zone: "Calarreona", features: "D√∫plex 3 hab, 2 ba√±os", sqm: 153, extras: ["Terraza", "Garaje"], price: 165000, appraisal: 189525, diff_eur: 24525, diff_perc: 14.9, alert: "[27] *Supera presupuesto*. Se incluye por su excelente diferencial. Amplio d√∫plex ideal para familias grandes. Requiere verificar si el precio es negociable a 150.000‚Ç¨.", rooms: 3 },
    { id: "CA-06", location: "Casco Antiguo", zone: "Casco Antiguo / Centro", features: "Piso 3 hab, 2 ba√±os", sqm: 123, extras: ["Balc√≥n", "Reformado"], price: 150000, appraisal: 170985, diff_eur: 20985, diff_perc: 14.0, alert: "[27, 33] Totalmente reformado, lo que elimina la necesidad de inversi√≥n inicial. Amplio y bien ubicado. Sin ascensor ni garaje.", rooms: 3 },
    { id: "LC-05", location: "Los Collados - Los Geraneos", zone: "Los Collados / Los Geraneos", features: "√Åtico 2 hab, 1 ba√±o", sqm: 61, extras: ["Terraza", "Garaje", "Piscina"], price: 141500, appraisal: 160918, diff_eur: 19418, diff_perc: 13.7, alert: "[30] √Åtico con sol√°rium privado, un extra muy cotizado. Complejo con todos los servicios. Precio en el l√≠mite alto para su tama√±o.", rooms: 2 },
    { id: "CA-07", location: "Casco Antiguo", zone: "Casco Antiguo / Centro", features: "Planta baja 3 hab, 2 ba√±os", sqm: 80, extras: ["Ascensor"], price: 150000, appraisal: 168000, diff_eur: 18000, diff_perc: 12.0, alert: "[27] Precio rebajado. Planta baja en edificio con ascensor, buena accesibilidad. El estado parece bueno, a verificar.", rooms: 3 },
    { id: "LM-03", location: "Las Lomas - Las Yucas, Pza. Guti√©rrez Mellado", zone: "Las Lomas / Las Yucas", features: "Piso 3 hab, 1 ba√±o", sqm: 120, extras: ["Sin ascensor"], price: 144000, appraisal: 160128, diff_eur: 16128, diff_perc: 11.2, alert: "[26] Muy espacioso (120 m¬≤). La falta de ascensor en una planta alta puede ser un inconveniente importante para el alquiler.", rooms: 3 },
    { id: "LC-06", location: "Los Collados - Los Geraneos", zone: "Los Collados / Los Geraneos", features: "Apartamento 2 hab, 2 ba√±os", sqm: 60, extras: ["Terraza", "Garaje", "Piscina"], price: 143000, appraisal: 158825, diff_eur: 15825, diff_perc: 11.1, alert: "[30] Anuncio con descripci√≥n detallada. Complejo moderno con buenas calidades. Precio algo elevado para 60m¬≤, pero justificado por los extras.", rooms: 2 },
    { id: "CA-08", location: "Casco Antiguo, C/ Francisco D√≠az Romero", zone: "Casco Antiguo / Centro", features: "Piso 3 hab, 2 ba√±os", sqm: 130, extras: ["Sin ascensor"], price: 140000, appraisal: 154700, diff_eur: 14700, diff_perc: 10.5, alert: "[27] Anuncio con mucha antig√ºedad (+250 d√≠as), lo que sugiere que el precio de venta podr√≠a ser altamente negociable. Muy espacioso.", rooms: 3 },
];

const strategyData = [
    {
        title: "Perfiles Detallados de las 5 Inversiones Principales",
        content: `
            <ul class="list-disc list-inside space-y-2 text-slate-600">
                <li><b>LC-01 (Los Collados):</b> Con un diferencial del 41.5%, es la oportunidad cuantitativa m√°s clara. Su bajo precio para una vivienda con todos los extras es excepcional. Riesgo principal: dependencia del coche. Acci√≥n clave: verificar estado y gastos de comunidad.</li>
                <li><b>LC-02 (Los Collados):</b> Similar al anterior, pero su gran terraza de 35m¬≤ es un activo inmenso para el alquiler tur√≠stico, justificando su alto diferencial del 39%.</li>
                <li><b>CA-01 (Casco Antiguo):</b> Caso de alto riesgo/alta recompensa. Un precio de 46.500 ‚Ç¨ es an√≥malo y, al ser activo bancario, probablemente requiere una reforma integral (estimada 30k-40k‚Ç¨). El diferencial del 36% solo se materializa si la reforma se controla.</li>
                <li><b>LM-01 (Las Lomas):</b> La inversi√≥n m√°s segura y equilibrada. Su diferencial del 28.5% es s√≥lido, y su ubicaci√≥n a 200m de la Playa de Poniente con vistas al mar garantiza una alta demanda y una tarifa superior.</li>
                <li><b>LC-03 (Los Collados):</b> Atractivo por su practicidad. Una planta baja con acceso directo a la piscina es un gran reclamo para familias, y al estar en buen estado, permite una puesta en alquiler inmediata.</li>
            </ul>
        `
    },
    {
        title: "Identificaci√≥n de Riesgos y Due Diligence",
        content: `
            <ul class="list-disc list-inside space-y-2 text-slate-600">
                <li><b>El Dilema de Los Collados:</b> Ofrece la mejor relaci√≥n precio/calidad, pero su dependencia del coche es un factor a destacar claramente en la comercializaci√≥n del alquiler.</li>
                <li><b>El Riesgo del Casco Antiguo:</b> Su encanto y ubicaci√≥n son sus fortalezas, pero el riesgo reside en la antig√ºedad (posibles derramas) y, sobre todo, la frecuente ausencia de ascensor, que limita el perfil del inquilino.</li>
                <li><b>La Trampa del "Precio de Derribo":</b> Activos bancarios muy baratos como el CA-01 pueden ocultar costes de reforma que erosionen el margen de beneficio. Una inspecci√≥n t√©cnica es imperativa.</li>
                <li><b>La Estacionalidad:</b> Aunque el Carnaval ayuda, la demanda sigue muy concentrada en verano y Semana Santa. El plan de negocio debe contemplar periodos de vacancia.</li>
            </ul>
        `
    },
    {
        title: "Conclusi√≥n y Recomendaciones Finales",
        content: `
            <ol class="list-decimal list-inside space-y-2 text-slate-600">
                <li><b>Priorizar Visitas:</b> Contactar de inmediato a las agencias del "Top 10", con foco en LC-01, LM-01 y LC-02. La velocidad es clave en un mercado en alza.</li>
                <li><b>Negociaci√≥n Basada en Datos:</b> Utilizar el Valor de Peritaje de este an√°lisis como herramienta objetiva para negociar, especialmente en anuncios con larga permanencia (ej. CA-08).</li>
                <li><b>Foco Geogr√°fico:</b> Centrar la b√∫squeda en Los Collados (comodidades), Calarreona (turismo familiar) y Casco Antiguo (ubicaci√≥n, aceptando compromisos).</li>
            </ol>
            <p class="mt-4 text-slate-600">Con una estrategia disciplinada, es factible adquirir un activo en √Åguilas con un valor de mercado intr√≠nseco superior a su coste, sentando las bases para una inversi√≥n rentable y con potencial de revalorizaci√≥n.</p>
        `
    }
];

document.addEventListener('DOMContentLoaded', () => {
    const zoneContainer = document.getElementById('zone-container');
    const propertiesContainer = document.getElementById('properties-container');
    const zoneFiltersContainer = document.getElementById('zone-filters');
    const extrasFiltersContainer = document.getElementById('extras-filters');
    const roomsFiltersContainer = document.getElementById('rooms-filters');
    const sortBySelect = document.getElementById('sort-by');
    const noResults = document.getElementById('no-results');
    const resetFiltersBtn = document.getElementById('reset-filters');

    const modal = document.getElementById('property-modal');
    const modalContent = document.getElementById('modal-content');
    
    const strategyContainer = document.getElementById('strategy-container');

    let filters = {
        zones: [],
        extras: [],
        rooms: []
    };

    function formatCurrency(value) {
        return new Intl.NumberFormat('es-ES', { style: 'currency', currency: 'EUR', minimumFractionDigits: 0 }).format(value);
    }

    function getIconForExtra(extra) {
        switch(extra.toLowerCase()) {
            case 'terraza': return '‚òÄÔ∏è';
            case 'garaje': return 'üöó';
            case 'piscina': return 'üèä';
            case 'ascensor': return 'elevator'; // Special case
            case 'vistas mar': return 'üåä';
            case 'balc√≥n': return 'üèûÔ∏è';
            default: return '‚úÖ';
        }
    }

    function renderZones() {
        zoneContainer.innerHTML = zonesData.map(zone => `
            <div class="bg-white p-6 rounded-xl shadow-md border border-slate-200 cursor-pointer transition-all duration-300 hover:shadow-cyan-100 hover:border-cyan-300" onclick="this.querySelector('p').classList.toggle('hidden')">
                <div class="flex justify-between items-start">
                    <h3 class="text-lg font-bold text-slate-800 mb-2">${zone.name}</h3>
                    <span class="text-cyan-600 font-semibold">${zone.price}</span>
                </div>
                <p class="text-slate-600 text-sm hidden">${zone.description}</p>
                 <span class="text-xs text-cyan-700 font-semibold mt-2 inline-block">Pulsar para ver descripci√≥n</span>
            </div>
        `).join('');
    }
    
    function renderStrategy() {
        strategyContainer.innerHTML = strategyData.map((item, index) => `
            <div class="bg-white rounded-lg shadow-md border border-slate-200 overflow-hidden">
                <button class="w-full text-left p-4 flex justify-between items-center font-semibold text-slate-800 hover:bg-slate-100" onclick="document.getElementById('strategy-content-${index}').classList.toggle('hidden'); this.querySelector('span').classList.toggle('rotate-180')">
                    ${item.title}
                    <span class="transform transition-transform duration-300">&#9660;</span>
                </button>
                <div id="strategy-content-${index}" class="p-4 border-t border-slate-200 hidden">
                    ${item.content}
                </div>
            </div>
        `).join('');
    }

    function renderProperties(properties) {
        if (properties.length === 0) {
            noResults.classList.remove('hidden');
            propertiesContainer.classList.add('hidden');
        } else {
            noResults.classList.add('hidden');
            propertiesContainer.classList.remove('hidden');
        }
        
        propertiesContainer.innerHTML = properties.map(p => `
            <div class="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden flex flex-col property-card" data-id="${p.id}">
                <div class="p-6 flex-grow">
                    <div class="flex justify-between items-start mb-2">
                        <span class="text-xs font-semibold uppercase tracking-wider text-cyan-600 bg-cyan-50 px-2 py-1 rounded-full">${p.zone}</span>
                        <div class="text-right">
                             <span class="text-xl font-bold text-green-600">+${p.diff_perc.toFixed(1)}%</span>
                             <p class="text-xs text-slate-500">Rentabilidad</p>
                        </div>
                    </div>
                    <h3 class="font-bold text-lg text-slate-900 mb-1">${p.features}</h3>
                    <p class="text-sm text-slate-500 mb-4">${p.location}</p>
                    
                    <div class="grid grid-cols-2 gap-4 text-sm mb-4">
                        <div>
                            <p class="text-slate-500">Precio Venta</p>
                            <p class="font-semibold text-slate-800">${formatCurrency(p.price)}</p>
                        </div>
                        <div>
                            <p class="text-slate-500">Valor Peritaje</p>
                            <p class="font-semibold text-slate-800">${formatCurrency(p.appraisal)}</p>
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-2 mb-4">
                        ${p.extras.map(extra => {
                            if (extra === 'Ascensor') {
                                return `<div class="text-xs flex items-center bg-slate-100 text-slate-600 px-2 py-1 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 3a1 1 0 01.707.293l3 3a1 1 0 01-1.414 1.414L10 5.414 7.707 7.707a1 1 0 01-1.414-1.414l3-3A1 1 0 0110 3zm-3.707 9.293a1 1 0 011.414 0L10 14.586l2.293-2.293a1 1 0 011.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" /></svg> Ascensor</div>`;
                            }
                            return `<span class="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded-full">${getIconForExtra(extra)} ${extra}</span>`;
                        }).join('')}
                    </div>
                </div>
                <div class="bg-slate-50 p-4 border-t border-slate-200">
                    <button class="w-full bg-cyan-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-cyan-700 transition-colors" onclick="openModal('${p.id}')">Ver Detalles</button>
                </div>
            </div>
        `).join('');
    }

    function renderFilters() {
        const uniqueZones = [...new Set(propertiesData.map(p => p.zone))];
        zoneFiltersContainer.innerHTML = uniqueZones.map(zone => `
            <label class="flex items-center space-x-2 text-sm text-slate-600 cursor-pointer">
                <input type="checkbox" class="form-checkbox h-4 w-4 rounded text-cyan-600 focus:ring-cyan-500" value="${zone}">
                <span>${zone}</span>
            </label>
        `).join('');

        const uniqueExtras = ['Garaje', 'Piscina', 'Terraza'];
        extrasFiltersContainer.innerHTML = uniqueExtras.map(extra => `
            <label class="flex items-center space-x-2 text-sm text-slate-600 cursor-pointer">
                <input type="checkbox" class="form-checkbox h-4 w-4 rounded text-cyan-600 focus:ring-cyan-500" value="${extra}">
                <span>${extra}</span>
            </label>
        `).join('');

        const uniqueRooms = [...new Set(propertiesData.map(p => p.rooms))].sort();
        roomsFiltersContainer.innerHTML = uniqueRooms.map(room => `
            <label class="flex items-center space-x-2 text-sm text-slate-600 cursor-pointer">
                <input type="checkbox" class="form-checkbox h-4 w-4 rounded text-cyan-600 focus:ring-cyan-500" value="${room}">
                <span>${room} hab.</span>
            </label>
        `).join('');
    }
    
    function applyFiltersAndSort() {
        filters.zones = Array.from(zoneFiltersContainer.querySelectorAll('input:checked')).map(el => el.value);
        filters.extras = Array.from(extrasFiltersContainer.querySelectorAll('input:checked')).map(el => el.value);
        filters.rooms = Array.from(roomsFiltersContainer.querySelectorAll('input:checked')).map(el => parseInt(el.value));

        let filteredProperties = propertiesData.filter(p => {
            const zoneMatch = filters.zones.length === 0 || filters.zones.includes(p.zone);
            const extrasMatch = filters.extras.every(extra => p.extras.includes(extra));
            const roomsMatch = filters.rooms.length === 0 || filters.rooms.includes(p.rooms);
            return zoneMatch && extrasMatch && roomsMatch;
        });
        
        const sortValue = sortBySelect.value;
        filteredProperties.sort((a, b) => {
            switch(sortValue) {
                case 'diff_perc_desc': return b.diff_perc - a.diff_perc;
                case 'price_asc': return a.price - b.price;
                case 'price_desc': return b.price - a.price;
                case 'appraisal_desc': return b.appraisal - a.appraisal;
                default: return 0;
            }
        });

        renderProperties(filteredProperties);
    }
    
    function resetFilters() {
        zoneFiltersContainer.querySelectorAll('input:checked').forEach(el => el.checked = false);
        extrasFiltersContainer.querySelectorAll('input:checked').forEach(el => el.checked = false);
        roomsFiltersContainer.querySelectorAll('input:checked').forEach(el => el.checked = false);
        sortBySelect.value = 'diff_perc_desc';
        applyFiltersAndSort();
    }
    
    window.openModal = (id) => {
        const property = propertiesData.find(p => p.id === id);
        if (!property) return;

        modalContent.innerHTML = `
            <div class="p-6 md:p-8">
                <div class="flex justify-between items-start">
                    <div>
                        <span class="text-sm font-semibold uppercase tracking-wider text-cyan-600 bg-cyan-50 px-2 py-1 rounded-full">${property.zone}</span>
                        <h2 class="text-2xl md:text-3xl font-bold text-slate-900 mt-2">${property.features}</h2>
                        <p class="text-slate-500">${property.location}</p>
                    </div>
                    <button class="text-slate-400 hover:text-slate-600" onclick="closeModal()">&times;</button>
                </div>

                <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                         <h4 class="font-bold text-slate-800 mb-3">Detalles del Inmueble</h4>
                         <div class="space-y-3 text-sm">
                            <div class="flex justify-between"><span class="text-slate-500">Superficie:</span> <span class="font-semibold">${property.sqm} m¬≤</span></div>
                            <div class="flex justify-between"><span class="text-slate-500">Habitaciones:</span> <span class="font-semibold">${property.rooms}</span></div>
                            <div class="flex justify-between items-start"><span class="text-slate-500">Extras:</span> <span class="font-semibold text-right">${property.extras.join(', ')}</span></div>
                         </div>
                         <h4 class="font-bold text-slate-800 mb-3 mt-6">An√°lisis de Valor</h4>
                         <div class="space-y-3 text-sm">
                            <div class="flex justify-between"><span class="text-slate-500">Precio de Venta:</span> <span class="font-semibold text-cyan-700">${formatCurrency(property.price)}</span></div>
                            <div class="flex justify-between"><span class="text-slate-500">Valor de Peritaje:</span> <span class="font-semibold text-cyan-700">${formatCurrency(property.appraisal)}</span></div>
                            <div class="flex justify-between bg-green-50 p-2 rounded-md"><span class="text-green-800 font-semibold">Diferencial (Valor):</span> <span class="font-bold text-green-800">${formatCurrency(property.diff_eur)}</span></div>
                            <div class="flex justify-between bg-green-50 p-2 rounded-md"><span class="text-green-800 font-semibold">Diferencial (%):</span> <span class="font-bold text-green-800">+${property.diff_perc.toFixed(1)}%</span></div>
                         </div>
                    </div>
                     <div class="bg-slate-50 p-4 rounded-lg">
                        <h4 class="font-bold text-slate-800 mb-2">Observaciones y Puntos de Alerta</h4>
                        <p class="text-slate-600 text-sm italic">${property.alert}</p>
                    </div>
                </div>
            </div>
             <div class="bg-slate-100 p-4 text-right">
                <button class="px-6 py-2 bg-slate-600 text-white font-semibold rounded-lg hover:bg-slate-700 transition" onclick="closeModal()">Cerrar</button>
            </div>
        `;
        
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        setTimeout(() => {
            modalContent.classList.remove('scale-95', 'opacity-0');
        }, 50);
    }
    
    window.closeModal = () => {
        modalContent.classList.add('scale-95', 'opacity-0');
        setTimeout(() => {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }, 200);
    }

    function renderCharts() {
        const profitabilityCtx = document.getElementById('profitabilityByZoneChart').getContext('2d');
        const priceVsAppraisalCtx = document.getElementById('priceVsAppraisalChart').getContext('2d');

        const zones = [...new Set(propertiesData.map(p => p.zone))];
        const avgProfitabilityByZone = zones.map(zone => {
            const zoneProps = propertiesData.filter(p => p.zone === zone);
            const totalProfit = zoneProps.reduce((acc, curr) => acc + curr.diff_perc, 0);
            return totalProfit / zoneProps.length;
        });

        new Chart(profitabilityCtx, {
            type: 'bar',
            data: {
                labels: zones,
                datasets: [{
                    label: 'Rentabilidad Media (%)',
                    data: avgProfitabilityByZone,
                    backgroundColor: 'rgba(8, 145, 178, 0.6)',
                    borderColor: 'rgba(8, 145, 178, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { y: { beginAtZero: true, title: { display: true, text: 'Rentabilidad (%)' } } }
            }
        });
        
        const scatterData = propertiesData.map(p => ({ x: p.price, y: p.appraisal, label: p.id }));
        
        new Chart(priceVsAppraisalCtx, {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'Propiedades',
                    data: scatterData,
                    backgroundColor: 'rgba(22, 163, 74, 0.7)'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                let label = context.dataset.data[context.dataIndex].label || '';
                                if (label) { label += ': '; }
                                label += `(Venta: ${formatCurrency(context.parsed.x)}, Peritaje: ${formatCurrency(context.parsed.y)})`;
                                return label;
                            }
                        }
                    },
                    legend: { display: false }
                },
                scales: {
                    x: { title: { display: true, text: 'Precio de Venta (‚Ç¨)' } },
                    y: { title: { display: true, text: 'Valor de Peritaje (‚Ç¨)' } }
                }
            }
        });
    }

    // Initial setup
    renderZones();
    renderStrategy();
    renderFilters();
    applyFiltersAndSort();
    renderCharts();
    
    zoneFiltersContainer.addEventListener('change', applyFiltersAndSort);
    extrasFiltersContainer.addEventListener('change', applyFiltersAndSort);
    roomsFiltersContainer.addEventListener('change', applyFiltersAndSort);
    sortBySelect.addEventListener('change', applyFiltersAndSort);
    resetFiltersBtn.addEventListener('click', resetFilters);
    
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            closeModal();
        }
    });
});
</script>
</body>
</html>
